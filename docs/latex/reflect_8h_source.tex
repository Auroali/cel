\hypertarget{reflect_8h_source}{}\doxysection{reflect.\+h}
\label{reflect_8h_source}\index{src/cel/reflect/reflect.h@{src/cel/reflect/reflect.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#include <functional>}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <cstddef>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <optional>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#define REFLECT() \(\backslash\)}}
\DoxyCodeLine{10 \textcolor{preprocessor}{protected: \(\backslash\)}}
\DoxyCodeLine{11 \textcolor{preprocessor}{virtual cel::reflection::type* get\_type() \{ return \&reflect\_type\_intern; \} \(\backslash\)}}
\DoxyCodeLine{12 \textcolor{preprocessor}{private: \(\backslash\)}}
\DoxyCodeLine{13 \textcolor{preprocessor}{static cel::reflection::type reflect\_type\_intern; \(\backslash\)}}
\DoxyCodeLine{14 \textcolor{preprocessor}{static void init\_reflect(cel::reflection::type*); \(\backslash\)}}
\DoxyCodeLine{15 \textcolor{preprocessor}{friend class cel::reflection::solver}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#define REFLECT\_DEFINE(Typename) \(\backslash\)}}
\DoxyCodeLine{18 \textcolor{preprocessor}{cel::reflection::type Typename::reflect\_type\_intern(\#Typename, Typename::init\_reflect); \(\backslash\)}}
\DoxyCodeLine{19 \textcolor{preprocessor}{void Typename::init\_reflect(cel::reflection::type* r\_type) \{ \(\backslash\)}}
\DoxyCodeLine{20 \textcolor{preprocessor}{    using T = Typename; \(\backslash\)}}
\DoxyCodeLine{21 \textcolor{preprocessor}{    r\_type-\/>size = sizeof(T); \(\backslash\)}}
\DoxyCodeLine{22 \textcolor{preprocessor}{    r\_type-\/>fact = new cel::reflection::type\_factory<T>(); \(\backslash\)}}
\DoxyCodeLine{23 \textcolor{preprocessor}{    r\_type-\/>members = \{}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#define REFLECT\_MEMBER(member) \(\backslash\)}}
\DoxyCodeLine{26 \textcolor{preprocessor}{        \{ \#member, offsetof(T, member), sizeof(T::member), SERIALIZE \},}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{preprocessor}{\#define REFLECT\_MEMBER\_WITH(member, attrib) \(\backslash\)}}
\DoxyCodeLine{29 \textcolor{preprocessor}{        \{ \#member, offsetof(T, member), sizeof(T::member), attrib \},}}
\DoxyCodeLine{30         }
\DoxyCodeLine{31 \textcolor{preprocessor}{\#define REFLECT\_END() \(\backslash\)}}
\DoxyCodeLine{32 \textcolor{preprocessor}{    \}; \(\backslash\)}}
\DoxyCodeLine{33 \textcolor{preprocessor}{    cel::reflection::solver::\_\_register(r\_type); \(\backslash\)}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\}}}
\DoxyCodeLine{35 }
\DoxyCodeLine{39 \textcolor{preprocessor}{\#define SERIALIZE 0x01UL}}
\DoxyCodeLine{40 }
\DoxyCodeLine{44 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacecel_1_1reflection}{cel::reflection}} \{}
\DoxyCodeLine{48     \textcolor{keyword}{class }\mbox{\hyperlink{classcel_1_1reflection_1_1factory__base}{factory\_base}} \{}
\DoxyCodeLine{49     \textcolor{keyword}{public}:}
\DoxyCodeLine{50         \textcolor{keyword}{virtual} \textcolor{keywordtype}{void}* make() \{ \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr}; \}}
\DoxyCodeLine{51         \textcolor{keyword}{virtual} std::shared\_ptr<void> make\_shared() \{ \textcolor{keywordflow}{return} std::shared\_ptr<void>(); \}}
\DoxyCodeLine{52         \textcolor{keyword}{virtual} \mbox{\hyperlink{classcel_1_1reflection_1_1factory__base}{\string~factory\_base}}() \{\}}
\DoxyCodeLine{53     \};}
\DoxyCodeLine{62     \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{63     \textcolor{keyword}{class }\mbox{\hyperlink{classcel_1_1reflection_1_1type__factory}{type\_factory}} : \textcolor{keyword}{public} \mbox{\hyperlink{classcel_1_1reflection_1_1factory__base}{factory\_base}} \{}
\DoxyCodeLine{64     \textcolor{keyword}{public}:}
\DoxyCodeLine{70         \textcolor{keyword}{virtual} \textcolor{keywordtype}{void}* \mbox{\hyperlink{classcel_1_1reflection_1_1type__factory_ac4d245a6fefb95b2cbc75547f41ea466}{make}}()\textcolor{keyword}{ override }\{ \textcolor{keywordflow}{return} \textcolor{keyword}{new} T; \}}
\DoxyCodeLine{77         \textcolor{keyword}{virtual} std::shared\_ptr<void> \mbox{\hyperlink{classcel_1_1reflection_1_1type__factory_aead7b70285d08171d519d62a74864f17}{make\_shared}}()\textcolor{keyword}{ override }\{}
\DoxyCodeLine{78             \textcolor{keywordflow}{return} std::static\_pointer\_cast<void>(std::make\_shared<T>());}
\DoxyCodeLine{79         \}}
\DoxyCodeLine{80     \};}
\DoxyCodeLine{81     \textcolor{keyword}{struct }\mbox{\hyperlink{structcel_1_1reflection_1_1member}{member}} \{}
\DoxyCodeLine{82         std::string name;}
\DoxyCodeLine{83         \textcolor{keywordtype}{size\_t} offset;}
\DoxyCodeLine{84         \textcolor{keywordtype}{size\_t} size;}
\DoxyCodeLine{85         \textcolor{keywordtype}{size\_t} attribs;}
\DoxyCodeLine{86         }
\DoxyCodeLine{87         \mbox{\hyperlink{structcel_1_1reflection_1_1member}{\string~member}}() \{\}}
\DoxyCodeLine{96         \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{97         T\& \mbox{\hyperlink{structcel_1_1reflection_1_1member_acbd30af5696c5033f66c9345585de003}{as}}(\textcolor{keywordtype}{void}* \mbox{\hyperlink{structcel_1_1reflection_1_1member_a5b6921177a49bb8f859f882ba952356e}{ptr}}) \{}
\DoxyCodeLine{98             \textcolor{keywordflow}{return} *((T*)\mbox{\hyperlink{structcel_1_1reflection_1_1member_a5b6921177a49bb8f859f882ba952356e}{ptr}}+offset); }
\DoxyCodeLine{99         \}}
\DoxyCodeLine{100 }
\DoxyCodeLine{108         \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{109         \textcolor{keywordtype}{void} \mbox{\hyperlink{structcel_1_1reflection_1_1member_a1df83aa292183cc1c99392231a995ff7}{set}}(\textcolor{keywordtype}{void}* \mbox{\hyperlink{structcel_1_1reflection_1_1member_a5b6921177a49bb8f859f882ba952356e}{ptr}}, T\&\& val) \{}
\DoxyCodeLine{110             *((T*)\mbox{\hyperlink{structcel_1_1reflection_1_1member_a5b6921177a49bb8f859f882ba952356e}{ptr}}+offset) = val;}
\DoxyCodeLine{111         \}}
\DoxyCodeLine{118         \textcolor{keywordtype}{char}* \mbox{\hyperlink{structcel_1_1reflection_1_1member_a5b6921177a49bb8f859f882ba952356e}{ptr}}(\textcolor{keywordtype}{void}* obj) \{}
\DoxyCodeLine{119             \textcolor{keywordflow}{return} (\textcolor{keywordtype}{char}*)obj+offset;}
\DoxyCodeLine{120         \}}
\DoxyCodeLine{129         \textcolor{keywordtype}{bool} \mbox{\hyperlink{structcel_1_1reflection_1_1member_aed8db68f9a0f24b841d3bbd9e438acf7}{has\_attrib}}(\textcolor{keywordtype}{size\_t} attrib) \{}
\DoxyCodeLine{130             \textcolor{keywordflow}{return} attribs \& attrib;}
\DoxyCodeLine{131         \}}
\DoxyCodeLine{132     \};}
\DoxyCodeLine{133     \textcolor{keyword}{struct }\mbox{\hyperlink{structcel_1_1reflection_1_1type}{type}} \{}
\DoxyCodeLine{134         \mbox{\hyperlink{structcel_1_1reflection_1_1type}{type}}(\textcolor{keyword}{const} std::string\& tname, std::function<\textcolor{keywordtype}{void}(\mbox{\hyperlink{structcel_1_1reflection_1_1type}{type}}*)> func) \{}
\DoxyCodeLine{135             this-\/>name = tname;}
\DoxyCodeLine{136             func(\textcolor{keyword}{this});}
\DoxyCodeLine{137         \}}
\DoxyCodeLine{144         std::optional<member> \mbox{\hyperlink{structcel_1_1reflection_1_1type_a0d857708bcbe8cda7aa6dde733403b40}{get\_member}}(\textcolor{keyword}{const} std::string\& name);}
\DoxyCodeLine{145         std::string name;}
\DoxyCodeLine{146         \textcolor{keywordtype}{size\_t} size;}
\DoxyCodeLine{147         std::vector<member> members;}
\DoxyCodeLine{148         \mbox{\hyperlink{classcel_1_1reflection_1_1factory__base}{factory\_base}}* fact;}
\DoxyCodeLine{149         \mbox{\hyperlink{structcel_1_1reflection_1_1type}{\string~type}}() \{}
\DoxyCodeLine{150             \textcolor{keyword}{delete} fact;}
\DoxyCodeLine{151         \}}
\DoxyCodeLine{152     \};}
\DoxyCodeLine{157     \textcolor{keyword}{class }\mbox{\hyperlink{classcel_1_1reflection_1_1solver}{solver}} \{}
\DoxyCodeLine{158     \textcolor{keyword}{private}:}
\DoxyCodeLine{159         \textcolor{keyword}{static} std::vector<type*> ref\_types;}
\DoxyCodeLine{160     \textcolor{keyword}{public}:}
\DoxyCodeLine{168         \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{classcel_1_1reflection_1_1solver_a12c46936fa73f3d61578178ac7718640}{\_\_register}}(\mbox{\hyperlink{structcel_1_1reflection_1_1type}{type}}* \mbox{\hyperlink{structcel_1_1reflection_1_1type}{type}});}
\DoxyCodeLine{169 }
\DoxyCodeLine{176         \textcolor{keyword}{static} \mbox{\hyperlink{structcel_1_1reflection_1_1type}{type}}* \mbox{\hyperlink{classcel_1_1reflection_1_1solver_a464577c9b7aed9090f9f746853a9284a}{get\_by\_str}}(\textcolor{keyword}{const} std::string\& name);}
\DoxyCodeLine{177         \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{178         \textcolor{keyword}{static} \mbox{\hyperlink{structcel_1_1reflection_1_1type}{type}}* get\_from() \{}
\DoxyCodeLine{179             \textcolor{keywordflow}{return} \&T::reflect\_type\_intern;}
\DoxyCodeLine{180         \}}
\DoxyCodeLine{189         \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{190         \textcolor{keyword}{static} \mbox{\hyperlink{structcel_1_1reflection_1_1type}{type}}* \mbox{\hyperlink{classcel_1_1reflection_1_1solver_aad2aa04f0b939ce5810cb1431092d3d9}{get\_from}}(T* ptr) \{}
\DoxyCodeLine{191             \textcolor{keywordflow}{return} ptr-\/>get\_type();}
\DoxyCodeLine{192         \}}
\DoxyCodeLine{193     \};}
\DoxyCodeLine{194 \}}

\end{DoxyCode}
